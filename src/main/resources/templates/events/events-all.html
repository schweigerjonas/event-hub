<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    layout:decorate="~{layout}">
<main layout:fragment="main">
    <div class="container py-4">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
            <h1 class="mb-0">Events in deiner Nähe</h1>
            <a class="btn btn-primary d-flex align-items-center gap-1" th:href="@{/events/new}"
               sec:authorize="hasAnyAuthority('ADMIN','ORGANISATOR')">
                <span class="material-symbols-outlined">add</span>
                Event erstellen
            </a>
        </div>

        <form th:action="@{/events}" method="get" class="row g-2 align-items-end">
            <div class="col-12 col-md-5">
                <label class="form-label" for="keyword">Suche</label>
                <input id="keyword" type="search" name="keyword" class="form-control" placeholder="Name oder Ort" th:value="${keyword}">
            </div>
            <div class="col-6 col-md-2">
                <label class="form-label" for="sort">Sortierung</label>
                <select id="sort" name="sort" class="form-select">
                    <option value="time" th:selected="${sort == 'time'}">Zeitpunkt</option>
                    <option value="name" th:selected="${sort == 'name'}">Name</option>
                    <option value="costs" th:selected="${sort == 'costs'}">Kosten</option>
                </select>
            </div>
            <div class="col-6 col-md-2">
                <label class="form-label" for="direction">Richtung</label>
                <select id="direction" name="direction" class="form-select">
                    <option value="asc" th:selected="${direction == 'asc'}">Aufsteigend</option>
                    <option value="desc" th:selected="${direction == 'desc'}">Absteigend</option>
                </select>
            </div>
            <div class="col-6 col-md-2">
                <label class="form-label" for="size">Einträge</label>
                <select id="size" name="size" class="form-select">
                    <option th:each="s : ${ {6, 9, 12} }" th:value="${s}" th:text="${s}" th:selected="${s == pageSize}"></option>
                </select>
            </div>
            <div class="col-6 col-md-1 d-grid">
                <button class="btn btn-outline-secondary" type="submit">Suchen</button>
            </div>
            <div class="align-items-center" sec:authorize="isAuthenticated()">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="onlyFavourites" name="onlyFavourites" th:checked="${onlyFavourites}">
                    <label class="form-check-label" for="onlyFavourites">
                        Nur favorisierte Events
                    </label>
                </div>
            </div>
        </form>

        <div class="row g-3 mt-3">
            <div class="col-12" th:if="${#lists.isEmpty(events)}">
                <div class="alert alert-secondary mb-0">Keine Events gefunden.</div>
            </div>
            <div class="col-12 col-md-6 col-lg-4" th:each="event : ${events}">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <div class="mb-2">
                            <h5 class="card-title mb-1" th:text="${event.name}">Event</h5>
                            <div class="text-muted" th:text="${event.location}">Ort</div>
                        </div>
                        <div class="small text-muted mb-2" th:if="${event.eventTime != null}">
                            <span th:text="${#temporals.format(event.eventTime, 'dd.MM.yyyy HH:mm')}"></span>
                        </div>
                        <div class="mb-1" th:if="${event.durationMinutes != null}">
                            <span>Dauer: </span><span th:text="${event.durationMinutes}"></span><span> min</span>
                        </div>
                        <div class="mb-3" th:if="${event.maxParticipants != null}">
                            <span>Max. Teilnehmer: </span><span th:text="${event.maxParticipants}"></span>
                        </div>
                        <div class="mb-3">
                            <span>Kosten: </span>
                            <span th:if="${event.costs > 0}" th:text="${#numbers.formatDecimal(event.costs, 1, 2)} + ' EUR'"></span>
                            <span th:if="${event.costs <= 0}">Kostenlos</span>
                        </div>
                        <a class="btn btn-outline-primary mt-auto" th:href="@{'/events/' + ${event.id}}">Details</a>
                    </div>
                </div>
            </div>
        </div>

        <nav aria-label="Pagination" class="mt-4" th:if="${totalPages > 1}">
            <ul class="pagination">
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/events(page=1, size=${pageSize}, keyword=${keyword}, sort=${sort}, direction=${direction})}"><<</a>
                </li>
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/events(page=${currentPage - 1}, size=${pageSize}, keyword=${keyword}, sort=${sort}, direction=${direction})}">Zurück</a>
                </li>
                <li class="page-item disabled" th:if="${currentPage - 2 > 1}">
                    <span class="page-link">...</span>
                </li>
                <li class="page-item" th:each="page : ${#numbers.sequence(currentPage > 2 ? currentPage - 2 : 1, currentPage + 2 < totalPages ? currentPage + 2 : totalPages)}"
                    th:classappend="${page == currentPage} ? 'active'">
                    <a class="page-link"
                       th:href="@{/events(page=${page}, size=${pageSize}, keyword=${keyword}, sort=${sort}, direction=${direction})}"
                       th:text="${page}">1</a>
                </li>
                <li class="page-item disabled" th:if="${currentPage + 2 < totalPages}">
                    <span class="page-link">...</span>
                </li>
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/events(page=${currentPage + 1}, size=${pageSize}, keyword=${keyword}, sort=${sort}, direction=${direction})}">Weiter</a>
                </li>
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/events(page=${totalPages}, size=${pageSize}, keyword=${keyword}, sort=${sort}, direction=${direction})}">>></a>
                </li>
            </ul>
        </nav>
    </div>
</main>
</html>
